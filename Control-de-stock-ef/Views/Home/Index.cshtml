@model _ProveedorProductoViewModel
@{
    ViewData["Title"] = "Home Page";
    //calculo de total de articulos en stock
    var cantidad = 0;
    @foreach (var item in Model.Productos) 
    {
        cantidad += item.StockActual;
    }
    //calculo de productos con stock bajo
    //es decir, productos cuyo stock actual es menor o igual al stock minimo
    var ProductosStockBajo = 0;
    @foreach (var item in Model.Productos) 
    {
        if (item.StockActual <= item.StockMinimo)
        {
            ProductosStockBajo += 1;
        }
    }
    var ProveedoresActivos = 0;
    @foreach (var item in Model.Proveedores) 
    {
        ProveedoresActivos += 1;
    }
}

<main class="">
    <!-- Page Header -->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Dashboard de inventario</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <button class="btn btn-sm btn-outline-primary me-2" type="button">
                <i class="bi bi-download me-1"></i> Exportar reporte
            </button>
            <a class="btn btn-sm btn-primary" asp-controller="Productos" asp-action="Index" >
                <i class="bi bi-plus-lg me-1"></i> Añadir al inventario
            </a>
        </div>
    </div>
    <!-- BEGIN: SummaryWidgets -->
    <div class="row g-3 mb-4" data-purpose="dashboard-widgets">
        <!-- Total Products Card -->
        <div class="col-12 col-sm-6 col-lg-4">
            <div class="card card-widget border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
               
                        <div>
                                <p class="text-muted mb-1 fw-medium">Total Stock Productos</p>
                                <h2 class="fw-bold mb-0">@cantidad</h2>
                        </div>
                       
                        <div class="bg-primary bg-opacity-10 p-2 rounded">
                            <i class="bi bi-box-seam text-primary fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Low Stock Alert Card -->
        <div class="col-12 col-sm-6 col-lg-4">
            <div class="card card-widget low-stock-alert shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1 fw-medium">Alerta de stock bajo</p>
                            <h2 class="fw-bold mb-0 text-danger">@ProductosStockBajo</h2>
                        </div>
                        <div class="bg-danger bg-opacity-10 p-2 rounded">
                            <i class="bi bi-exclamation-triangle text-danger fs-4"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <span class="badge bg-danger">Requieren atención</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Active Suppliers Card -->
        <div class="col-12 col-sm-12 col-lg-4">
            <div class="card card-widget border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1 fw-medium">Proveedores Activos</p>
                            <h2 class="fw-bold mb-0">@ProveedoresActivos</h2>
                        </div>
                        <div class="bg-success bg-opacity-10 p-2 rounded">
                            <i class="bi bi-truck text-success fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END: SummaryWidgets -->
    <!-- BEGIN: RecentMovements -->
    <div class="row" data-purpose="recent-movements-section">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="card-title mb-0 fw-bold">Movimientos recientes</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="px-4">Productos</th>
                                    <th>Categoria</th>
                                    <th>Tipo Movimiento</th>
                                    <th>Cantidad</th>
                                    <th class="px-4">Fecha Movimiento</th>
                                    <th>Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Item 1 -->
                                @foreach (var mov in Model.UltimosMovimientos)
                                {
                                    <tr>
                                        <td class="px-4 fw-medium">@mov.Producto?.Nombre</td>
                                        <td>@mov.Producto?.Categoria?.Nombre</td>
                                        <td>
                                            <span class="status-dot @(mov.Tipo == TipoMovimiento.Entrada ? "bg-success" : "bg-danger")"></span>
                                            @mov.Tipo
                                        </td>
                                        <td class="@(mov.Tipo == TipoMovimiento.Entrada ? "text-success" : "text-danger") fw-bold">
                                            @(mov.Tipo == TipoMovimiento.Entrada ? "+" : "-")@mov.Cantidad
                                        </td>                                       
                                        <td class="px-4 text-muted small">@mov.Fecha.ToString("dd/MM HH:mm")</td>
                                        <td>
                                            <a asp-controller="Transaccion" asp-action="Create" asp-route-productoId="@mov.ProductoId" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-exchange-alt"></i> Mover Stock
                                            </a>
                                        </td>
                                    </tr>
                                }
                             
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END: RecentMovements -->
</main>